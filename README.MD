# ðŸ“ˆ Jimarque â€” TWSE/TPEX Data Pipeline

> å¾ž **TWSEã€TPEX** ç­‰ç¶²ç«™æŠ“å–å¸‚å ´/å€‹è‚¡æŒ‡æ¨™ï¼Œæ¸…æ´—å¾Œæ‰¹é‡å¯«å…¥ **PostgreSQL**ã€‚æ”¯æ´ **é‡è©¦/é€€é¿/éš¨æ©ŸæŠ–å‹•**ã€**UA/ä»£ç†è¼ªæ›**ã€ä»¥åŠ **æ¯æ—¥æŽ’ç¨‹**ã€‚

[![Python](https://img.shields.io/badge/Python-3.12+-3776AB.svg?logo=python&logoColor=white)](#requirements)
[![PostgreSQL](https://img.shields.io/badge/PostgreSQL-14+-336791.svg?logo=postgresql&logoColor=white)](#database-schema)
[![License](https://img.shields.io/badge/License-MIT-black.svg)](#license)

---

## ç›®éŒ„
- [æ¦‚è¦½](#æ¦‚è¦½)
- [è³‡æ–™ä¾†æº](#è³‡æ–™ä¾†æº)
- [ç³»çµ±æž¶æ§‹](#ç³»çµ±æž¶æ§‹)
- [å¿«é€Ÿé–‹å§‹](#å¿«é€Ÿé–‹å§‹)
- [è¨­å®š](#è¨­å®š)
- [è³‡æ–™åº«çµæ§‹](#è³‡æ–™åº«çµæ§‹)
- [å¸¸ç”¨è…³æœ¬èˆ‡æŒ‡ä»¤](#å¸¸ç”¨è…³æœ¬èˆ‡æŒ‡ä»¤)
- [æŽ’ç¨‹](#æŽ’ç¨‹)
- [é™¤éŒ¯æŒ‡å—](#é™¤éŒ¯æŒ‡å—)
- [æœ€ä½³åŒ–å»ºè­°](#æœ€ä½³åŒ–å»ºè­°)
- [å°ˆæ¡ˆçµæ§‹ï¼ˆå»ºè­°ï¼‰](#å°ˆæ¡ˆçµæ§‹å»ºè­°)
- [License](#license)

---

## æ¦‚è¦½
- ðŸ” **IP/UA è¼ªæ›**ï¼šå®šæ™‚æˆ–æ¯ N æ¬¡åˆ‡èº«ä»½ï¼›403/429/5xx è‡ªå‹•é€€é¿ä¸¦æ›èº«åˆ†  
- ðŸ§ª **åž‹åˆ¥æ¸…æ´—**ï¼š`"" / "-"` â†’ `NULL`ï¼›æ•¸å­—å­—ä¸²åŽ»é€—è™Ÿå†è½‰ `Decimal/int`  
- ðŸ§® **æ‰¹æ¬¡å¯«å…¥**ï¼š`psycopg2.extras.execute_values`ï¼ˆæˆ– `COPY`ï¼‰  
- ðŸ§± **UPSERT/åŽ»é‡**ï¼šç”¨ `(da, code)` æˆ–è¤‡åˆéµé¿å…é‡è¦†  
- ðŸ›¡ï¸ **TLS ç›¸å®¹**ï¼ˆå¯é¸ï¼‰ï¼šå°ç‰¹å®šç«™é»žæ”¾å¯¬ OpenSSL åš´æ ¼éˆæª¢æ ¸ï¼ˆä»é©—æ†‘è­‰ï¼‰

---

## è³‡æ–™ä¾†æº
- **TWSE**ï¼š`/rwd/zh/afterTrading/BWIBBU_d?date=YYYYMMDD&selectType=ALL&response=json`ï¼ˆæ®–åˆ©çŽ‡/æœ¬ç›Šæ¯”/æ·¨å€¼æ¯”/æ”¶ç›¤åƒ¹â€¦ï¼‰
- **TPEX**ï¼š`/www/zh-tw/afterTrading/PERatio?date=YYYY/MM/DD&response=json`ï¼ˆä¸Šæ«ƒ PER æŒ‡æ¨™ï¼‰
- ï¼ˆå¯é¸ï¼‰**TWSE OpenAPI**ï¼š`/v1/exchangeReport/BWIBBU_d` / `BWIBBU_ALL`

> è«‹éµå®ˆå„ç¶²ç«™ ToSã€æµé‡é™åˆ¶èˆ‡ robots è¦ç¯„ã€‚

---

## ç³»çµ±æž¶æ§‹
```mermaid
flowchart LR
  A[Scheduler/CLI] --> B[Fetcher (requests.Session)]
  B -->|UA/Proxy/Retry/Backoff| C[Parser & Normalizer]
  C --> D[Batch Writer]
  D -->|execute_values / COPY| E[(PostgreSQL)]
  E --> F[Analytics/BI/Backtests]
